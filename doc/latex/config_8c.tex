\hypertarget{config_8c}{}\section{config.\+c File Reference}
\label{config_8c}\index{config.\+c@{config.\+c}}


find,read,parse,sync \& write a config file  


{\ttfamily \#include \char`\"{}include/config.\+h\char`\"{}}\newline
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{config_8c_a306dd790fe17aefe81da552fe930ca77}{add\+Error} (struct error $\ast$error, int error\+\_\+code, char $\ast$error\+\_\+msg, int index)
\begin{DoxyCompactList}\small\item\em add a new member to the struct error \end{DoxyCompactList}\item 
void \hyperlink{config_8c_ac47b4c0d8485f089512b1f29b0124d7c}{build\+Bool\+Format} (int value, char $\ast$type, char $\ast$str)
\begin{DoxyCompactList}\small\item\em generate the format for either the cancel or the notify option \end{DoxyCompactList}\item 
int \hyperlink{config_8c_ab88f88555e9f94b84c3f9903b760f2ae}{dir\+Exist} (char $\ast$path)
\begin{DoxyCompactList}\small\item\em Check if the path points to a directory. \end{DoxyCompactList}\item 
F\+I\+L\+E\+\_\+\+S\+T\+A\+TE \hyperlink{config_8c_a16b9036966017dcd1e984efc00a2cbff}{find\+Config} (char $\ast$name, char $\ast$path)
\begin{DoxyCompactList}\small\item\em find the file within the expected location \end{DoxyCompactList}\item 
O\+P\+T\+I\+O\+N\+\_\+\+S\+T\+A\+TE \hyperlink{config_8c_aeef1429ecbca92684426d749d4cee2a0}{get\+Option} (struct configcontent $\ast$config, char $\ast$option, int index)
\begin{DoxyCompactList}\small\item\em compares option title with the valid titles, save in configcontent \end{DoxyCompactList}\item 
int \hyperlink{config_8c_ad43ea5d2ceb169a3cd2af2f9b5c68af3}{index\+In\+List} (struct configcontent $\ast$config, int index)
\begin{DoxyCompactList}\small\item\em Checks if the index of a row is within the set of configcontent. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{config_8c_a6abe6c5eb77aeaf05ad81a7425547d9e}\label{config_8c_a6abe6c5eb77aeaf05ad81a7425547d9e}} 
int {\bfseries mkstemp} (char $\ast$template)
\item 
int \hyperlink{config_8c_a4798e732cf8172e82df65fad850b057e}{parse\+Config} (struct configcontent $\ast$content, struct error $\ast$error, struct config $\ast$config)
\begin{DoxyCompactList}\small\item\em capture the options and translate them to the config structure \end{DoxyCompactList}\item 
C\+O\+N\+F\+I\+G\+\_\+\+S\+T\+A\+TE \hyperlink{config_8c_abccc6b215b84b7f0db431b53e032fc8a}{read\+Config} (struct configcontent $\ast$config, struct error $\ast$error, char $\ast$path)
\begin{DoxyCompactList}\small\item\em read the config file in .task/csw and fill the config struct \end{DoxyCompactList}\item 
int \hyperlink{config_8c_a2d5d802c600005b98a5179055eb2d005}{sync\+Config} (struct config $\ast$config, struct flags $\ast$flag, struct tm $\ast$time)
\begin{DoxyCompactList}\small\item\em syncronize config values with the current time and flags \end{DoxyCompactList}\item 
\mbox{\Hypertarget{config_8c_af3cee068f32a919cdd638e0578c1e5f8}\label{config_8c_af3cee068f32a919cdd638e0578c1e5f8}} 
int {\bfseries unlink} (const char $\ast$pathname)
\item 
int \hyperlink{config_8c_ad2eb140ecf033ee2fad1309b1366a4e2}{value\+For\+Key} (struct keyvalue $\ast$table, char $\ast$str)
\begin{DoxyCompactList}\small\item\em compare string with valid keys and return the enum(\+F\+I\+N\+D) int value \end{DoxyCompactList}\item 
int \hyperlink{config_8c_a21d86894ce0f2ec5f4abc491dfd65fab}{write\+Config} (struct config $\ast$config, char $\ast$path)
\begin{DoxyCompactList}\small\item\em write the current state of the config structure to a file \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
find,read,parse,sync \& write a config file 

\begin{DoxyAuthor}{Author}
Sebastian Fricke 
\end{DoxyAuthor}


\subsection{Function Documentation}
\mbox{\Hypertarget{config_8c_a306dd790fe17aefe81da552fe930ca77}\label{config_8c_a306dd790fe17aefe81da552fe930ca77}} 
\index{config.\+c@{config.\+c}!add\+Error@{add\+Error}}
\index{add\+Error@{add\+Error}!config.\+c@{config.\+c}}
\subsubsection{\texorpdfstring{add\+Error()}{addError()}}
{\footnotesize\ttfamily void add\+Error (\begin{DoxyParamCaption}\item[{struct error $\ast$}]{error,  }\item[{int}]{error\+\_\+code,  }\item[{char $\ast$}]{error\+\_\+msg,  }\item[{int}]{index }\end{DoxyParamCaption})}



add a new member to the struct error 

Used for interfunction communication about a wrong syntax in the config of the user.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em error} & pointer to structure error \\
\hline
\mbox{\tt in}  & {\em error\+\_\+code} & a integer (-\/1$\vert$-\/2$\vert$-\/3), points out the error type \\
\hline
\mbox{\tt in}  & {\em error\+\_\+msg} & a string of max. length M\+A\+X\+\_\+\+R\+OW with error details \\
\hline
\mbox{\tt in}  & {\em index} & index of the row where the error is located \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{config_8c_ac47b4c0d8485f089512b1f29b0124d7c}\label{config_8c_ac47b4c0d8485f089512b1f29b0124d7c}} 
\index{config.\+c@{config.\+c}!build\+Bool\+Format@{build\+Bool\+Format}}
\index{build\+Bool\+Format@{build\+Bool\+Format}!config.\+c@{config.\+c}}
\subsubsection{\texorpdfstring{build\+Bool\+Format()}{buildBoolFormat()}}
{\footnotesize\ttfamily void build\+Bool\+Format (\begin{DoxyParamCaption}\item[{int}]{value,  }\item[{char $\ast$}]{type,  }\item[{char $\ast$}]{str }\end{DoxyParamCaption})}



generate the format for either the cancel or the notify option 

transforms a 1 to a \textquotesingle{}on\textquotesingle{} and a 0 to a \textquotesingle{}off\textquotesingle{}, if the value has changed to any other value enter E\+R\+R\+OR as value


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em value} & the boolean either 0 or 1 \\
\hline
\mbox{\tt in}  & {\em type} & the option type either \textquotesingle{}Cancel\textquotesingle{} or \textquotesingle{}Notify\textquotesingle{} \\
\hline
\mbox{\tt out}  & {\em str} & the format string used in the write\+Config function \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{config_8c_ab88f88555e9f94b84c3f9903b760f2ae}\label{config_8c_ab88f88555e9f94b84c3f9903b760f2ae}} 
\index{config.\+c@{config.\+c}!dir\+Exist@{dir\+Exist}}
\index{dir\+Exist@{dir\+Exist}!config.\+c@{config.\+c}}
\subsubsection{\texorpdfstring{dir\+Exist()}{dirExist()}}
{\footnotesize\ttfamily int dir\+Exist (\begin{DoxyParamCaption}\item[{char $\ast$}]{path }\end{DoxyParamCaption})}



Check if the path points to a directory. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em path} & The path to location of the directory \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 0} & The directory exists \\
\hline
{\em 1} & path is valid but doesn\textquotesingle{}t point to a directory \\
\hline
{\em -\/1} & path not valid \\
\hline
{\em -\/2} & stat malfunctions \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{config_8c_a16b9036966017dcd1e984efc00a2cbff}\label{config_8c_a16b9036966017dcd1e984efc00a2cbff}} 
\index{config.\+c@{config.\+c}!find\+Config@{find\+Config}}
\index{find\+Config@{find\+Config}!config.\+c@{config.\+c}}
\subsubsection{\texorpdfstring{find\+Config()}{findConfig()}}
{\footnotesize\ttfamily F\+I\+L\+E\+\_\+\+S\+T\+A\+TE find\+Config (\begin{DoxyParamCaption}\item[{char $\ast$}]{name,  }\item[{char $\ast$}]{path }\end{DoxyParamCaption})}



find the file within the expected location 

locate the .task folder in the directory of the user, check if a csw folder exists, create one if necessary, check it for size and extension, then allocate the path on the heap and return it as the parameter path.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em name} & the name of the file to be found \\
\hline
\mbox{\tt out}  & {\em path} & string that contains the realpath \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em F\+I\+L\+E\+\_\+\+G\+O\+OD} & file found \& without problems \\
\hline
{\em F\+I\+L\+E\+\_\+\+E\+R\+R\+OR} & Name doesn\textquotesingle{}t exist/\+Folder creation malfunctioned \\
\hline
{\em F\+I\+L\+E\+\_\+\+N\+O\+T\+F\+O\+U\+ND} & file was not found in .task/csw/ \\
\hline
\end{DoxyRetVals}
\begin{DoxyDate}{Date}
2019-\/10-\/10 
\end{DoxyDate}
\mbox{\Hypertarget{config_8c_aeef1429ecbca92684426d749d4cee2a0}\label{config_8c_aeef1429ecbca92684426d749d4cee2a0}} 
\index{config.\+c@{config.\+c}!get\+Option@{get\+Option}}
\index{get\+Option@{get\+Option}!config.\+c@{config.\+c}}
\subsubsection{\texorpdfstring{get\+Option()}{getOption()}}
{\footnotesize\ttfamily O\+P\+T\+I\+O\+N\+\_\+\+S\+T\+A\+TE get\+Option (\begin{DoxyParamCaption}\item[{struct configcontent $\ast$}]{config,  }\item[{char $\ast$}]{option,  }\item[{int}]{index }\end{DoxyParamCaption})}



compares option title with the valid titles, save in configcontent 

Valid Titles are\+: \begin{DoxyItemize}
\item zone, start, end, context \item exclude \item delay, cancel, notify\end{DoxyItemize}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em option} & the string to parse \\
\hline
\mbox{\tt in}  & {\em index} & the current line in the config \\
\hline
\mbox{\tt out}  & {\em config} & the pointer to the config struct\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em O\+P\+T\+I\+O\+N\+\_\+\+S\+U\+C\+C\+E\+SS} & option found and value assigned to struct instance \\
\hline
{\em O\+P\+T\+I\+O\+N\+\_\+\+N\+O\+T\+F\+O\+U\+ND} & option not found in valid titles \\
\hline
{\em O\+P\+T\+I\+O\+N\+\_\+\+N\+O\+V\+A\+L\+UE} & option found but no value assigned \\
\hline
{\em O\+P\+T\+I\+O\+N\+\_\+\+E\+R\+R\+OR} & return on failure of function \\
\hline
\end{DoxyRetVals}
\begin{DoxyDate}{Date}
2019-\/10-\/11 
\end{DoxyDate}
\mbox{\Hypertarget{config_8c_ad43ea5d2ceb169a3cd2af2f9b5c68af3}\label{config_8c_ad43ea5d2ceb169a3cd2af2f9b5c68af3}} 
\index{config.\+c@{config.\+c}!index\+In\+List@{index\+In\+List}}
\index{index\+In\+List@{index\+In\+List}!config.\+c@{config.\+c}}
\subsubsection{\texorpdfstring{index\+In\+List()}{indexInList()}}
{\footnotesize\ttfamily int index\+In\+List (\begin{DoxyParamCaption}\item[{struct configcontent $\ast$}]{config,  }\item[{int}]{index }\end{DoxyParamCaption})}



Checks if the index of a row is within the set of configcontent. 

The index are added in order to the structure, if the search index is below any element, then it cannot be inside the structure.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em config} & pointer to the configcontent structure \\
\hline
\mbox{\tt in}  & {\em index} & integer of the specific row index \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 0} & index within the set \\
\hline
{\em -\/1} & index not within the set \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{config_8c_a4798e732cf8172e82df65fad850b057e}\label{config_8c_a4798e732cf8172e82df65fad850b057e}} 
\index{config.\+c@{config.\+c}!parse\+Config@{parse\+Config}}
\index{parse\+Config@{parse\+Config}!config.\+c@{config.\+c}}
\subsubsection{\texorpdfstring{parse\+Config()}{parseConfig()}}
{\footnotesize\ttfamily int parse\+Config (\begin{DoxyParamCaption}\item[{struct configcontent $\ast$}]{content,  }\item[{struct error $\ast$}]{error,  }\item[{struct config $\ast$}]{config }\end{DoxyParamCaption})}



capture the options and translate them to the config structure 

Parse the different options and fill the error structure whenever a option has a incorrect format.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em content} & configcontent structure pointer from \hyperlink{config_8c_abccc6b215b84b7f0db431b53e032fc8a}{read\+Config()} \\
\hline
\mbox{\tt out}  & {\em error} & error structure pointer \\
\hline
\mbox{\tt out}  & {\em config} & config structure pointer for the parse output\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 0} & S\+U\+C\+C\+E\+SS \\
\hline
{\em -\/1} & F\+A\+I\+L\+U\+RE \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{config_8c_abccc6b215b84b7f0db431b53e032fc8a}\label{config_8c_abccc6b215b84b7f0db431b53e032fc8a}} 
\index{config.\+c@{config.\+c}!read\+Config@{read\+Config}}
\index{read\+Config@{read\+Config}!config.\+c@{config.\+c}}
\subsubsection{\texorpdfstring{read\+Config()}{readConfig()}}
{\footnotesize\ttfamily C\+O\+N\+F\+I\+G\+\_\+\+S\+T\+A\+TE read\+Config (\begin{DoxyParamCaption}\item[{struct configcontent $\ast$}]{config,  }\item[{struct error $\ast$}]{error,  }\item[{char $\ast$}]{path }\end{DoxyParamCaption})}



read the config file in .task/csw and fill the config struct 

Z\+O\+NE=\{N\+A\+ME\};S\+T\+A\+RT=\{Start\+\_\+t\};E\+ND=\{End\+\_\+t\};C\+O\+N\+T\+E\+XT=\{context option from tw\}; \textquotesingle{};\textquotesingle{} the option separator , \textquotesingle{}=\textquotesingle{} the value separator


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em path} & path to the config file \\
\hline
\mbox{\tt out}  & {\em config} & pointer to heap allocated struct \\
\hline
\mbox{\tt out}  & {\em error} & error structure for notification\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em C\+O\+N\+F\+I\+G\+\_\+\+S\+U\+C\+C\+E\+SS} & config read success, no errors \\
\hline
{\em C\+O\+N\+F\+I\+G\+\_\+\+B\+AD} & config has a bad format \\
\hline
{\em C\+O\+N\+F\+I\+G\+\_\+\+N\+O\+T\+F\+O\+U\+ND} & config file was not found in .task/csw \\
\hline
\end{DoxyRetVals}
\begin{DoxyDate}{Date}
2019-\/10-\/12 
\end{DoxyDate}
\mbox{\Hypertarget{config_8c_a2d5d802c600005b98a5179055eb2d005}\label{config_8c_a2d5d802c600005b98a5179055eb2d005}} 
\index{config.\+c@{config.\+c}!sync\+Config@{sync\+Config}}
\index{sync\+Config@{sync\+Config}!config.\+c@{config.\+c}}
\subsubsection{\texorpdfstring{sync\+Config()}{syncConfig()}}
{\footnotesize\ttfamily int sync\+Config (\begin{DoxyParamCaption}\item[{struct config $\ast$}]{config,  }\item[{struct flags $\ast$}]{flag,  }\item[{struct tm $\ast$}]{time }\end{DoxyParamCaption})}



syncronize config values with the current time and flags 

create or add a delay from the delay flag to the config, toggle the notify and cancel flags and set the interval value check for expired exclusions and store the indeces of expired/changed rows into the change structure.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em config} & config struct pointer to the parsed config values \\
\hline
\mbox{\tt in}  & {\em flag} & flags struct pointer to the cli options \\
\hline
\mbox{\tt in}  & {\em time} & tm struct pointer to the current time \& date\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 0} & synchronize successfully W\+I\+T\+H\+O\+UT changes \\
\hline
{\em 1} & synchronize successfully W\+I\+TH changes \\
\hline
{\em -\/1} & synchronize failed \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{config_8c_ad2eb140ecf033ee2fad1309b1366a4e2}\label{config_8c_ad2eb140ecf033ee2fad1309b1366a4e2}} 
\index{config.\+c@{config.\+c}!value\+For\+Key@{value\+For\+Key}}
\index{value\+For\+Key@{value\+For\+Key}!config.\+c@{config.\+c}}
\subsubsection{\texorpdfstring{value\+For\+Key()}{valueForKey()}}
{\footnotesize\ttfamily int value\+For\+Key (\begin{DoxyParamCaption}\item[{struct keyvalue $\ast$}]{table,  }\item[{char $\ast$}]{str }\end{DoxyParamCaption})}



compare string with valid keys and return the enum(\+F\+I\+N\+D) int value 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em table} & array of valid keys with values \\
\hline
\mbox{\tt in}  & {\em str} & the comparison string \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em F\+I\+ND} & one of the enum values of the F\+I\+ND enumeration \\
\hline
{\em B\+A\+D\+\_\+\+K\+EY} & -\/1 on a invalid key \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{config_8c_a21d86894ce0f2ec5f4abc491dfd65fab}\label{config_8c_a21d86894ce0f2ec5f4abc491dfd65fab}} 
\index{config.\+c@{config.\+c}!write\+Config@{write\+Config}}
\index{write\+Config@{write\+Config}!config.\+c@{config.\+c}}
\subsubsection{\texorpdfstring{write\+Config()}{writeConfig()}}
{\footnotesize\ttfamily int write\+Config (\begin{DoxyParamCaption}\item[{struct config $\ast$}]{config,  }\item[{char $\ast$}]{path }\end{DoxyParamCaption})}



write the current state of the config structure to a file 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em config} & pointer to the config structure containing the parsed options \\
\hline
\mbox{\tt in}  & {\em path} & string containing the path to the file\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 0} & the content was successfully written to the file \\
\hline
{\em -\/1} & error encountered while writing to the file \\
\hline
\end{DoxyRetVals}
